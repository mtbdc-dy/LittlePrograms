<html>
<head>
<title>Report MiGu</title>
    <script type="text/javascript">
    	var mpReportMigu=null;
    	var reportSID=null;
    	var reportMiguSID=null;
    	var mOperatorVal=5;
    	var gpReportMigu=$.parseJSON(gtop.getSIDText("report")).reportMigu;
    	var noticeInfos=gpReportMigu.noticeInfos.split(",");
    	var mOperatorCols=["",noticeInfos[0],noticeInfos[1]];

    	$(document).ready(function(){
    		mpReportMigu = new ReportMigu();
    	});

        function areaMigu(pData) {
            $('#areaMiguName').combobox({
                data:pData,
                valueField:'id',
                textField:'name',
                editable:false,
                multiple:true,
                formatter: function (row) {
                    var opts = $(this).combobox('options');
                    return '<input type="checkbox" class="combobox-checkbox" id="' + row[opts.valueField] + '">' + row[opts.textField]
                },
                onShowPanel: function () {
                    var opts = $(this).combobox('options');
                    var target = this;
                    var values = $(target).combobox('getValues');
                    $.map(values, function (value) {
                        var el = opts.finder.getEl(target, value);
                        el.find('input.combobox-checkbox')._propAttr('checked', true);
                    })
                },
                onLoadSuccess: function () {
                    var opts = $(this).combobox('options');
                    var target = this;
                    var values = $(target).combobox('getValues');
                    $.map(values, function (value) {
                        var el = opts.finder.getEl(target, value);
                        el.find('input.combobox-checkbox')._propAttr('checked', true);
                    })
                },

                onSelect: function (row) {
                    if(!bClick) {
                        return;
                    }
                    bClick = false;
                    var opts = $(this).combobox('options');
                    if(row.name==noticeInfos[5]){
                        var a= $("#areaMiguName").combobox('getData');
                        for(var i=0;i<a.length;i++){
                            $('#areaMiguName').combobox('select', a[i].id);
                            var el = opts.finder.getEl(this, a[i].id);
                            el.find('input.combobox-checkbox')._propAttr('checked', true);
                        }
                    }
                    //设置选中值所对应的复选框为选中状态
                    var el = opts.finder.getEl(this, row[opts.valueField]);
                    el.find('input.combobox-checkbox')._propAttr('checked', true);
                    mpReportMigu.getDimenIDs();
                },
                onUnselect: function (row) {
                    if(!bClick) {
                        return;
                    }
                    bClick = false;
                    var opts = $(this).combobox('options');
                    if(row.name==noticeInfos[5]){
                        var a= $("#areaMiguName").combobox('getData');
                        for(var i=0;i<a.length;i++){
                            $('#areaMiguName').combobox('unselect', a[i].id);
                            var el = opts.finder.getEl(this, a[i].id);
                            el.find('input.combobox-checkbox')._propAttr('checked', false);
                        }
                    }
                    var el = opts.finder.getEl(this, row[opts.valueField]);
                    el.find('input.combobox-checkbox')._propAttr('checked', false);
                    mpReportMigu.getDimenIDs();
                }
            });
        }
        var  bClick=false;
        function whichButton(e) {
            // var  a=e;
            bClick=true;
        }
    	//document.getElementById("id_body").style.height='670px';
    	$(window).resize(onResize);

    	function onResize(){
    		var h=document.documentElement.clientHeight; //获取页面可见高度
    		document.getElementById("id_body").style.height=(h-30)+'px';
    	}

    	function ReportMigu(){
    		var mFinalData=null;
    		var mDownFilName="";
    		var mpParam={
    			secFrom:'',secTo:'',location:'',dimension:'platform',platform:''
    		};

    		////////////////////////////////////////////////////

    		var mpGridCol=[
    		               //area,OnlineSucPlay,Latency,timeProprot,
                {dataField:'area',text:'',width:'200px'},
                {dataField:'Latency',text:'',width:'150px'},
                {dataField:'DownSpeed',text:'',width:'150px'},
                {dataField:'EPGLoadSuc',text:'',width:'150px'},

    		   {dataField:'OnlineSucPlay',text:'',width:'200px'}, 	//在线播放成功率=成功播放次数/总的播放次数

    		   {dataField:'timeProprot',text:'',width:'150px'},

    		   {dataField:'wifiAcount',text:'',width:'150px'},
    		   {dataField:'UnitTCaton',text:'',width:'150px'},	//
    		   {dataField:'CatonAcount',text:'',width:'150px'},
    		   {dataField:'EPGLoadDelay',text:'',width:'150px'},

    		   {dataField:'EPGRequests',text:'',width:'150px'},
    		   {dataField:'EPGReponses',text:'',width:'150px'},
    		   {dataField:'LoginSuc',text:'',width:'150px'},
    		];
    		//document.getElementById("id_body").style.height=670;
			var mpReportGrid=new ReportGrid($("#id_body"),"area");
    		var date = new Date();
    		var sec=date.getTime()/1000-86400;
    		date = new Date(sec*1000);
			var mouth=date.getMonth()+1;
			var day=date.getDate();
    		var curDate=date.getFullYear()+"-"+(mouth>=10?mouth:("0"+mouth))+"-"+(day>=10?day:("0"+day));
			date = new Date((sec-6*86400)*1000);
			mouth=date.getMonth()+1;
			day=date.getDate();
    		preDate=date.getFullYear()+"-"+(mouth>=10?mouth:("0"+mouth))+"-"+(day>=10?day:("0"+day));

    		document.getElementById("id_dateFrom").value=preDate;
    		document.getElementById("id_dateTo").value=curDate;

    		var dimenVals=[noticeInfos[2],noticeInfos[3],noticeInfos[4]];
    		////////////////////////////////////////////////////
    		function initpage(){
    			reportSID=$.parseJSON(gtop.getSIDText("report")).reportMain;
    			var miscSID=$.parseJSON(gtop.getSIDText("misc"));
    			reportMiguSID=$.parseJSON(gtop.getSIDText("report")).reportMigu;
    			var id_datetype=reportSID.dateSelect.split(",");

    			$("#id_curweek").text(id_datetype[0]);
    			$("#id_preweek").text(id_datetype[1]);
    			$("#id_curmonth").text(id_datetype[2]);
    			$("#id_premonth").text(id_datetype[3]);
                $(".la_hour").text(noticeInfos[7]);
    			if(gtop.gpCompanyCfg[gtop.gsCompany]&&gtop.gpCompanyCfg[gtop.gsCompany].hoursOfGranularity && gtop.gpCompanyCfg[gtop.gsCompany].hoursOfGranularity=="true"){
                    $("#id_curhour").css("display","block");
                    $("#id_curhour").text(id_datetype[5]);
                }else{
                    $("#id_curhour").css("display","none");
				}
    			if(gtop.gsCompany=="sihua_cmvideo"&&gtop.DefProvinceID==15)
    				$("#id_label_dateTo").text(noticeInfos[4]);
    			else
    				$("#id_label_dateTo").text(reportMiguSID.dateTo);
//     			for(var i=0;i<dimenVals.length;i++){
// 	    			$("#dimenType").append(new Option(dimenVals[i]),i);
//     			}
    			$("#id_label_area").text(reportMiguSID.area);
    			$("#id_platform_area").text(reportMiguSID.platform);
    			$("#id_programtype_area").text(reportMiguSID.programtype);
    			$("#id_deviceprovider_area").text(noticeInfos[3]);
    			$("#id_operator").text(noticeInfos[4]);
    			$("#id_create").text(miscSID.btn_create);
    			$("#btn_export").text(miscSID.btn_export);
    			//设置报表中列的名称

  				if(gtop.gsCompany==gtop.gpQingHai){
                    var mpGridCol_text=reportMiguSID.qhmpGridCol_text.split(",");

				}else if(gtop.gsCompany==gtop.gpSichuan){
                    var mpGridCol_text=reportMiguSID.sichuanGridCol_text.split(",");
				}
				else{
                    var mpGridCol_text=reportMiguSID.mpGridCol_text.split(",");
				}
  				for(var i=0;i<mpGridCol_text.length;i++){
  					mpGridCol[i].text=mpGridCol_text[i];
  				}
  				mpReportGrid.initColumn(mpGridCol, true);
    		}

    		this.updateSID = function(){
    			initpage();
    			setAreaList();
//     			setPlatform();
    			this.getDimenIDs();
    		}

    		function setAreaList(){
//     			if(gtop.DefProvinceID*1==1){
//     				$("#id_area").append(new Option(gtop.gpArea.location,gtop.gtop.DefProvinceID));
//     			}
//     			for(var i=0;i<gtop.gpArea.areaList.length;i++){
//     				if(gtop.gpArea.areaList[i].id==2)
//     					continue;
//     				if(gtop.DefProvinceID*1>1){ //省模式
//     					if(gtop.gpArea.areaList[i].id==gtop.DefProvinceID*1){
//     						$("#id_area").append(new Option(gtop.gpArea.areaList[i].location,gtop.gpArea.areaList[i].id));
//     					}
//     				}else{ //全国模式
//     					$("#id_area").append(new Option(gtop.gpArea.areaList[i].location,gtop.gpArea.areaList[i].id));
//     				}
//     			}
    			var pData=[];
    			var item;
    			var index=1;
    			pData[0]={id:-1,name:noticeInfos[5]};
    			if(gtop.DefProvinceID==1)
    				pData[index]={id:gtop.gpArea.id,name:gtop.gpArea.location};
    			index++;
    			for(var i=0;i<gtop.gpArea.areaList.length;i++){
    				item=gtop.gpArea.areaList[i];
    				if(item.id==2)//china,unknow
    					continue;

    				if(gtop.DefProvinceID>1){//省模式
    					if(item.id==gtop.DefProvinceID){
    						pData[1]={id:item.id,name:item.location};
							break;
    					}
    					continue;
    				}else{
						var flag=false;
    					if(gtop.gpCompanyCfg[gtop.gsCompany].provinceFiltration && gtop.gpCompanyCfg[gtop.gsCompany].provinceFiltration!=""){
							var nFProvinces=gtop.gpCompanyCfg[gtop.gsCompany].provinceFiltration.split("@");
							for(var p in nFProvinces){
								if(nFProvinces[p]==item.id){
									flag=true;
									break;
								}
							}
    					}
						if(flag){
							continue;
						}
   						pData[index]={id:item.id,name:item.location};
    				}
    				index++;
    			}
    			if(gtop.DefProvinceID>1){
    				var tmpArea=gtop.generalGetArea(gtop.gpArea,gtop.DefProvinceID);
    				for(var i=0;i<tmpArea.areaList.length;i++){
    					var tmp=tmpArea.areaList[i];
    					pData.push({id:tmp.id,name:tmp.location});
    				}
    			}
    			var source={
    				datatype:'json',
            		datafields:[
            			{name:'id'},
            			{name:'name'}
            		],
            		localdata:pData
            	};

            	// var dataAdapter = new $.jqx.dataAdapter(source);
            	// $("#id_area").jqxComboBox({
            	//     source: dataAdapter,
            	//     theme:'dekscom',
            	//     width: '100px',
            	//     height: '25px',
            	//     displayMember: "name",
            	//     valueMember: "id",
            	// 	checkboxes:true
            	// });
            	// $('#id_area').on('checkChange', function (event) {
            	// 	if(event.args.checked&&event.args.value==-1){
        			// 	   $("#id_area").jqxComboBox('checkAll');
         		// 	}else if(!event.args.checked&&event.args.value==-1){
        			// 	   $("#id_area").jqxComboBox('uncheckAll');
         		// 	}
            	// 	mpReportMigu.getDimenIDs();
      		    //  });
                areaMigu(pData);
    		}
    		var source={
        			datatype:'json',
        		    datafields:[
        		        {name:'id'},
        				{name:'name'}
        		    ],
        			localdata:[]
        		};
    		function setDevPro(){
    			if(!mDimenIDs){
    				updateJqxComBox([]);
    				return;
    			}
    			var arr_Ids=mDimenIDs.split(",");
    			var index=0;
    			var pData=[],item,obj;
    			pData[0]={id:-1,name:noticeInfos[5]};
    			for(var i=0;i<arr_Ids.length;i++){
    				for(var j=0;j<gtop.gpDevicePro.length;j++){
    					if(gtop.gpDevicePro[j].id*1==arr_Ids[i]*1){
    						if(gtop.gpDevicePro[j].name==noticeInfos[6])
    							continue;
    						index++;
    						pData[index]={id:arr_Ids[i]*1,name:gtop.gpDevicePro[j].name};
    					}
    				}
    			}
    			updateJqxComBox(pData);

    		}
    		function setPlatform(){
    			if(!mDimenIDs){
    				updateJqxComBox([]);
    				return;
    			}
    			var arr_Ids=mDimenIDs.split(",");
    			var index=0;
    			var pData=[],item,obj;
    			pData[0]={id:-1,name:noticeInfos[5]};
    			for(var i=0;i<arr_Ids.length;i++){
    				index++;
    				pData[index]={id:arr_Ids[i]*1,name:gtop.gpPlatform[parseInt(arr_Ids[i])].name};
    			}
    			updateJqxComBox(pData);
    		}
    		function setOperators(){
    			if(!mDimenIDs){
    				updateJqxComBox([]);
    				return;
    			}
    			var arr_Ids=mDimenIDs.split(",");
    			var index=0;
    			var pData=[],item,obj;
    			pData[0]={id:-1,name:noticeInfos[5]};
    			if(gtop.gsCompany==gtop.gpSiHua){
    				pData[1]={id:1,name:noticeInfos[1]};
    				pData[2]={id:2,name:noticeInfos[0]};
    			}else{
	    			for(var i=0;i<arr_Ids.length;i++){
	    				index++;
	    				pData[index]={id:arr_Ids[i]*1,name:gtop.gpNetwork.Operators[arr_Ids[i].trim()]};
	    			}
    			}
    			updateJqxComBox(pData);
    		}
    		//待做  根据选择设定DimenIDs
            function updateJqxComBox(data) {
                $('#platMiguForm').combobox({
                    data:data,
                    valueField:'id',
                    textField:'name',
                    editable:false,
                    multiple:true,
                    formatter: function (row) {
                        var opts = $(this).combobox('options');
                        return '<input type="checkbox" class="combobox-checkbox" id="' + row[opts.valueField] + '">' + row[opts.textField]
                    },
                    onShowPanel: function () {
                        var opts = $(this).combobox('options');
                        var target = this;
                        var values = $(target).combobox('getValues');
                        $.map(values, function (value) {
                            var el = opts.finder.getEl(target, value);
                            el.find('input.combobox-checkbox')._propAttr('checked', true);
                        })
                    },
                    onLoadSuccess: function () {
                        var opts = $(this).combobox('options');
                        var target = this;
                        var values = $(target).combobox('getValues');
                        $.map(values, function (value) {
                            var el = opts.finder.getEl(target, value);
                            el.find('input.combobox-checkbox')._propAttr('checked', true);
                        })
                    },

                    onSelect: function (row) {
                        if(!bClick) {
                            return;
                        }
                        bClick = false;
                        var opts = $(this).combobox('options');
                        if(row.name==noticeInfos[5]){
                            var a= $("#platMiguForm").combobox('getData');
                            for(var i=0;i<a.length;i++){
                                $('#platMiguForm').combobox('select', a[i].id);
                                var el = opts.finder.getEl(this, a[i].id);
                                el.find('input.combobox-checkbox')._propAttr('checked', true);
                            }
                        }
                        //设置选中值所对应的复选框为选中状态
                        var el = opts.finder.getEl(this, row[opts.valueField]);
                        el.find('input.combobox-checkbox')._propAttr('checked', true);
                    },
                    onUnselect: function (row) {
                        if(!bClick) {
                            return;
                        }
                        bClick = false;
                        var opts = $(this).combobox('options');
                        if(row.name==noticeInfos[5]){
                            var a= $("#platMiguForm").combobox('getData');
                            for(var i=0;i<a.length;i++){
                                $('#platMiguForm').combobox('unselect', a[i].id);
                                var el = opts.finder.getEl(this, a[i].id);
                                el.find('input.combobox-checkbox')._propAttr('checked', false);
                            }
                        }
                        var el = opts.finder.getEl(this, row[opts.valueField]);
                        el.find('input.combobox-checkbox')._propAttr('checked', false);
                    }
                });
            }

    		var bMerge=false;

    		//针对青海 展示市级信息
    		function ifGetCityInfo(location){
    			if(!location||location==""||typeof(location)!="string"){
    				return false;
    			}
    			var arr=location.split(",");
    			for(var i=0;i<arr.length;i++){
					if(arr[i]*1>34){
						return true;
					}
    			}
			 	return false;
    		}
    		function isMiguShanxi(){
    			if(gtop.gsCompany==gtop.gpSiHua&&gtop.DefProvinceID==8){
    				return true;
    			}
    			return false;
    		}
    		this.onGenerate = function(){
                var secFrom;
                var secTo;
    		    if(mIndex==1){
                    secFrom=document.getElementById("id_dateFrom").value+" "+$('#num1 option:selected').val()+":00:00";
                    secTo=document.getElementById("id_dateTo").value+" "+$('#num2 option:selected').val()+":00:00";
                    mpParam.secFrom=secFrom;
                    mpParam.secTo=secTo;
				}else{
                    secFrom=document.getElementById("id_dateFrom").value;
                    secTo=document.getElementById("id_dateTo").value;
                    mpParam.secFrom=secFrom+" 00:00:00";
                    mpParam.secTo=secTo+" 00:00:00";
                }
                if(secFrom==null||secTo==null){
                    alert($.parseJSON(gtop.getSIDText("misc")).timeError2);
                    return;
                }
                mpParam["tType"]=mIndex;		//查询时间间隔类型：1->小时;2:->其它
				mpParam.location=setSelectLocation();
    			setSelectPlatform();
    			if(mpParam.location=="")
					mpParam.location=gtop.DefProvinceID;
    			mpParam["isMigu"]=gtop.gsCompany==gtop.gpSiHua?true:false;
    			//是不是咪咕的山西省份登录
    			mpParam["isMiguShanxi"]=isMiguShanxi();
    			mpParam["bIncludeShanxi"]=mbIncludeShanXi;
    			if(mpParam["isMiguShanxi"]==true){
    				mpParam["bIncludeShanxi"]=false;
    			}
    			/* var data=[
    				{area:'shanghai',row:[{key:'live',a:2,b:5,c:23},{key:'vod',a:5,b:7,c:14}]},
    				{area:'beijing', row:[{key:'live',a:12,b:15,c:23},{key:'vod',a:15,b:17,c:14}]},
    				{area:'zhejiang',row:[{key:'live',a:22,b:25,c:23},{key:'vod',a:25,b:27,c:14}]},
    			];
    			mpReportGrid.updateData(data); */

    			$.ajax({complete:gComplete,
    				url:"reportaction!returnMiguData.action",
    				type:"post",
    				data:"paramData="+JSON.stringify(mpParam),
    				datatype:"json",
    				success:(function(data){

    					if(data.resultData){
    					    var nIdex=1;
    						var data=$.parseJSON(data.resultData);
    						//处理VodSum取来的数据  主要有：  下载速率，单位时间卡顿次数、卡顿次数占比、在线播放成功率、首帧响应时延、卡顿时间占比
    						var vodData=handleVodData(data.vod,mpParam);
    						//处理qnetwork表来的数据   :wifi接入占比
    						var netData=handleNetdata(data.net,mpParam);
    						//处理Epgsum表来的数据 主要有：EPG加载成功率、EPG加载时延
    						var epgData=handleEpgData(data.epg,mpParam,nIdex);
                            //处理Epgsum表来的数据：登录成功率
							nIdex=2;
    						var epgSucData=handleEpgData(data.epgSuc,mpParam,nIdex);

    						//整合以上数据
    						mFinalData=mergeVodAndEpgAndNet(vodData,epgData,epgSucData,netData,mpParam);

	    					//var test="{\"area\":\"shanghai\",\"row\":{\"key\":\"live\",\"a\":2,\"b\":5,\"c\":23},\"row\":{\"key\":\"vod\",\"a\":5,\"b\":7,\"c\":14}}";
	    					//var tetst1=$.parseJSON(test);
// 	    					mFinalData=handleData(sData);  //处理数据获取最终数据
	    					if(!mpParam.platform){   //节目
	    						bMerge=false;
	    						mpReportGrid.setColSpan(false);  //不合并
	    					}
	   						else{
	   							bMerge=true;
	   							mpReportGrid.setColSpan(true);  //合并
	   						}
	    					mpReportGrid.updateData(mFinalData);
    					}else{
    						mpReportGrid.updateData([]);
    					}
    				})
    			});
    		}

    		function handleNetdata(rsdata,param){
    			var objLoc=new Object();
    			for(var i=0;i<rsdata.length;i++){
	    			var sKpi=new Date(rsdata[i].KPIUTCSec.time).format("yyyy-MM-dd");
    				if(typeof(objLoc[rsdata[i].LocationID])=="undefined"){
    					objLoc[rsdata[i].LocationID]=calWifiData(rsdata[i]);
    				}else{
    					var tmp=calWifiData(rsdata[i]);
    					objLoc[rsdata[i].LocationID]=addWifi(objLoc[rsdata[i].LocationID],tmp);
    				}
    			}
    			var result=new Object();
    			for(var p in objLoc){
    				if(objLoc[p].Total==0)
    					result[p]=0;
    				else
    					result[p]=(objLoc[p].wifiCount*100/objLoc[p].Total).toFixed(2);
    			}
    			return result;
    		}
    		function addWifi(base,data){
    			base.wifiCount+=data.wifiCount;
    			base.Total+=data.Total;
    			return base;
    		}
    		function calWifiData(data){
    			var obj=new Object();
				obj["wifiCount"]=gtop.getDistTotal("2",data.DistStreamDevice);
				obj["Total"]=gtop.getDistTotal("",data.DistStreamDevice);
    			return obj;
    		}
    		function getName(id,param){
    			if(id*1==-1){
    				return id;
    			}else if(id*1==-2){
    				return noticeInfos[0];
    			}else if(id*1==-3)
    				return noticeInfos[1];
    			if(param.dimension=="platform"){
    				return gtop.gpPlatform[id*1].name;
    			}else if(param.dimension=="devProtype"){
    				if(id*1==100){
    					return  gtop.gpDevicePro[0].name;
    				}else
	    				return	gtop.gpDevicePro[id*1].name;
    			}else if(param.dimension=="platform"){
    				return gtop.gpNetwork.Operators[id];
    			}
    		}
    		function mergeVodAndEpgAndNet(vodData,epgData,epgSucData,netData,param){
    			var arr=new Array();
    			for(var p in vodData){
    			    if(mbIncludeShanXi && gtop.gsCompany==gtop.gpSiHua && mLocationNum==1 && p==1){ //单选山西省时，过滤掉全国
    			        continue;
					}
   					var obj=new Object();
   					obj["area"]=gtop.generalGetArea(gtop.gpArea,p*1).location;
   					obj["row"]=new Array();
    				for(var q in vodData[p]){
    					var tmpObj=new Object();
    					tmpObj["area"]=getName(q,param);
    					for(var k in vodData[p][q]){
    						tmpObj[k]=vodData[p][q][k];
    					}
    					if(epgSucData[p]&&epgSucData[p][q]){
    					    for(var k in epgSucData[p][q]){
                                tmpObj[k]=epgSucData[p][q][k];
							}
						}
    					if(epgData[p]&&epgData[p][q]){
    						for(var k in epgData[p][q]){
        						tmpObj[k]=epgData[p][q][k];
        					}
    					}
    					if(netData[p]){
    						tmpObj["wifiAcount"]=netData[p];
    					}
    					obj["row"].push(tmpObj);
    				}
	    			arr.push(obj);
    			}
    			return arr;
    		}
    		function mergeEpgData(data,bByDimen,param){
    			var result=new Object();
   				var tmp=new Object();
   				if(bByDimen&&!param.isMigu){
   					return data;
   				}
   				//不根据维度展示，计算所有维度的总数
    			if(!bByDimen){
	    			for(var p in data){
	    				for(var q in data[p]){
	    					if(typeof(data[p][q])=="Object")
	    						continue;
	    					if(typeof(tmp[q])=="undefined"){
	    						tmp[q]=data[p][q]*1;
	    					}else{
	    						tmp[q]+=data[p][q]*1;
	    					}
	    				}
	    			}
	    			result[-1]=tmp;
    			}
    			var bNetObj=new Object();
    			var yNetObj=new Object();
    			//咪咕  本网异网
    			if(bByDimen&&param.dimension=="operator"&&param.isMigu){
    				for(var p in data){
    					for(var q in data[p]){
	    					if(p*1==2){
	    						if(typeof(data[p][q])=="Object")
		    						continue;
	    						if(typeof(bNetObj[q])=="undefined"){
	    							bNetObj[q]=data[p][q]*1;
		    					}else{
		    						bNetObj[q]+=data[p][q]*1;
		    					}
	    					}else{
	    						if(typeof(yNetObj[q])=="undefined"){
	    							yNetObj[q]=data[p][q]*1;
		    					}else{
		    						yNetObj[q]+=data[p][q]*1;
		    					}
	    					}
    					}
    				}
	    			tmp[-2]=yNetObj;  //异网
	    			tmp[-3]=bNetObj; //本网
	    			result=tmp;
    			}
    			return result;
    		}

    		function handleEpgData(rsdata,mpParam,nIndex){
    			var kpiObj=new Object();
    			var bByDimenVal=false  //是否根据维度值汇总;
    			if(mpParam.platform!=""){
    				bByDimenVal=true;
    			}
    			//根据天 分类
//     			2017-04-19 00:00:00:Object
// 					23:Object                  locationid
// 						1:Object               Dimensionality
// 							0:Object           Faultid
// 								Pages:0
// 								Requests:749594
// 								Responses:733573
// 								SucPages:0
// 								TotEpgRspTime:2114596529
    			for(var i=0;i<rsdata.length;i++){
    				var sKpi=new Date(rsdata[i].KPIUTCSec.time).format("yyyy-MM-dd");
    				if(typeof(kpiObj[sKpi])=="undefined"){
    					kpiObj[sKpi]=new Object();
    				}
    				if(typeof(kpiObj[sKpi][rsdata[i].LocationID])=="undefined")
    					kpiObj[sKpi][rsdata[i].LocationID]=new Object();
   					kpiObj[sKpi][rsdata[i].LocationID][rsdata[i].Dimensionality]=rsdata[i];
    			}

    			var size=0;
    			for(var p in kpiObj)
    				size++;
   				for(var p in kpiObj){
   					for(var q in kpiObj[p]){
   						kpiObj[p][q]=mergeEpgData(kpiObj[p][q],bByDimenVal,mpParam);
   					}
   				}


    			var totalObj=new Object();
   				for(var p in kpiObj){
   					for(q in kpiObj[p]){
   						for(var k in kpiObj[p][q]){
	   						if(typeof(totalObj[q])=='undefined'){
	   							totalObj[q]=new Object();
	   							totalObj[q][k]=calEpg(kpiObj[p][q][k],nIndex);
	   						}else if(typeof(totalObj[q][k])=='undefined'){
	   							totalObj[q][k]=calEpg(kpiObj[p][q][k],nIndex);
	   						}else{
	   							var tmpData=calEpg(kpiObj[p][q][k],nIndex);
	   							totalObj[q][k]=addEpg(totalObj[q][k],tmpData);
	   						}
   						}
   					}
   				}

   				for(var p in totalObj){
   					for(q in totalObj[p]){
   						for(var k in totalObj[p][q]){
	   						totalObj[p][q][k]=(totalObj[p][q][k]*1/size).toFixed(2);
   						}
   					}
   				}
   				return totalObj;

    		}
    		function calEpg(baseData,nIndex){
    			var result=new Object();
    			result["EPGRequests"]=baseData.Requests;
    			result["EPGReponses"]=baseData.Responses;
    			if(baseData.Requests && nIndex==1){
    			    if(baseData.Requests!=0){
                        result["EPGLoadSuc"]=(baseData.Responses*100/baseData.Requests).toFixed(2)*1;
                    }else{
                        result["EPGLoadSuc"]=0;
                    }
                }
    			if(baseData.Requests && nIndex==2){
    			    if(baseData.Requests!=0){
                        result["LoginSuc"]=(baseData.Responses*100/baseData.Requests).toFixed(2)*1;
                    }else{
                        result["LoginSuc"]=0;
                    }
                }
                if(baseData.CntEpgRspTime && nIndex==1){
    			    if(baseData.CntEpgRspTime!=0){
                          result["EPGLoadDelay"]=baseData.TotEpgRspTime/baseData.CntEpgRspTime/1000;
                    }else{
                        result["EPGLoadDelay"]=0;
                    }
                }

    			return result;
    		}

    		function addEpg(baseData,data){
    			if(baseData.EPGLoadSuc || baseData.EPGLoadSuc==0){
                    baseData.EPGLoadSuc+=data.EPGLoadSuc;
                }
                if(baseData.LoginSuc || baseData.LoginSuc==0){
                    baseData.LoginSuc+=data.LoginSuc;
                }
                if(baseData.EPGLoadDelay || baseData.EPGLoadDelay==0){
                    baseData.EPGLoadDelay+=data.EPGLoadDelay;
                }
                baseData.EPGRequests+=data.EPGRequests;
                baseData.EPGReponses+=data.EPGReponses;
    			return baseData;
    		}

    		function handleVodData(rsdata,mpParam){
    			var bByDimenVal=false  //是否根据维度值汇总;
    			if(mpParam.platform!=""){
    				bByDimenVal=true;
    			}

    			//根据天 分类
//     			2017-04-19 00:00:00:Object
// 					23:Object                  locationid
// 						1:Object               Dimensionality
// 							0:Object           Faultid
// 								Count:5
// 								Dimensionality:1
// 								FaultID:0
// 								KPIUTCSec:Object
// 								LocationID:23
// 								Total:5
    			var kpiObj=new Object();
    			for(var i=0;i<rsdata.length;i++){
    				var sKpi=new Date(rsdata[i].KPIUTCSec.time).format("yyyy-MM-dd");
    				if(typeof(kpiObj[sKpi])=="undefined"){
    					kpiObj[sKpi]=new Object();
    				}
    				if(typeof(kpiObj[sKpi][rsdata[i].LocationID])=="undefined")
    					kpiObj[sKpi][rsdata[i].LocationID]=new Object();
    				if(typeof(kpiObj[sKpi][rsdata[i].LocationID][rsdata[i].Dimensionality])=="undefined")
    					kpiObj[sKpi][rsdata[i].LocationID][rsdata[i].Dimensionality]=new Object();
    				kpiObj[sKpi][rsdata[i].LocationID][rsdata[i].Dimensionality][rsdata[i].FaultID]=rsdata[i];
    			}

    			//计算有几天的数据
    			var size=0;
    			for(var p in kpiObj){
    				size++;
    			}

    			//根据维度统计信息
//     			2017-04-19 00:00:00:Object
//  					23:Object                  locationid
//  						1:Object               Dimensionality
	// 			    			CatonAcount:0
	// 							DownSpeed:0
	// 							Latency:1906.7473333333332O
	// 							nlineSucPlay:100
	// 							UnitTCaton:0
	// 							timeProprot:0
   				for(var sK in kpiObj){
   					for(var sL in kpiObj[sK]){
   						kpiObj[sK][sL]=mergeData(kpiObj[sK][sL],bByDimenVal,mpParam);
   					}
   				}


    		//求这么多天的数据之和
   				var totalObj=new Object();
   				for(var p in kpiObj){
   					for(q in kpiObj[p]){
   						for(var k in kpiObj[p][q]){
	   						if(typeof(totalObj[q])=='undefined'){
	   							totalObj[q]=new Object();
	   							totalObj[q][k]=kpiObj[p][q][k];
	   						}else if(typeof(totalObj[q][k])=='undefined'){
	   							totalObj[q][k]=kpiObj[p][q][k];
	   						}else
	   							totalObj[q][k]=addVod(totalObj[q][k],kpiObj[p][q][k]);
   						}

   					}
   				}

   				//求平均  除以天数
//    				23:Object                  locationid
//  					1:Object               Dimensionality （大于0：表示正常的维度值 -1：所有维度数据的总和数据，-2，-3：分别对应咪咕的：本网，异网数据）
// 			    			CatonAcount:0
// 							DownSpeed:0
// 							Latency:1906.7473333333332O
// 							nlineSucPlay:100
// 							UnitTCaton:0
// 							timeProprot:0
   				for(var p in totalObj){
   					for(q in totalObj[p]){
   						for(var k in totalObj[p][q]){
	   						totalObj[p][q][k]=(totalObj[p][q][k]/size).toFixed(2);
   						}
   					}
   				}


   				return totalObj;

    		}

    		function addVod(baseData,data){
    			baseData.OnlineSucPlay+=data.OnlineSucPlay;
    			baseData.Latency+=data.Latency;
    			baseData.timeProprot+=data.timeProprot;
    			baseData.DownSpeed+=data.DownSpeed;
    			baseData.UnitTCaton+=data.UnitTCaton;
    			baseData.CatonAcount+=data.CatonAcount;

    			return baseData;
    		}
    		function mergeData(sData,b,param){
    			var tmp=new Object;
    			var obj=new Object();

    			if(!b){
	    			for(var p in sData){
	    				for(var q in sData[p]){
	    					if(typeof(obj[q])=="undefined"){
	    						obj[q]=new Object();
	    						obj[q]["Total"]=sData[p][q].Total;
	    						obj[q]["Count"]=sData[p][q].Count;
	    					}else{
	    						obj[q]["Count"]+=sData[p][q].Count;
	    						obj[q]["Total"]+=sData[p][q].Total;
	    					}
	    				}
	    			}
	    			tmp[-1]=obj;
	    			sData=tmp;
    			}
    			var bNetObj=new Object();
    			var yNetObj=new Object();
    			//区分本网异网
    			if(param.dimension=="operator"&&b&&param.isMigu){
    				for(var p in sData){
	    				for(var q in sData[p]){
	    					if(p*1==2){
	    						if(typeof(bNetObj[q])=="undefined"){
	    							bNetObj[q]=new Object();
	    							bNetObj[q]["Total"]=sData[p][q].Total;
	    							bNetObj[q]["Count"]=sData[p][q].Count;
		    					}else{
		    						bNetObj[q]["Count"]+=sData[p][q].Count;
		    						bNetObj[q]["Total"]+=sData[p][q].Total;
		    					}
	    					}else{
		    					if(typeof(yNetObj[q])=="undefined"){
		    						yNetObj[q]=new Object();
		    						yNetObj[q]["Total"]=sData[p][q].Total;
		    						yNetObj[q]["Count"]=sData[p][q].Count;
		    					}else{
		    						yNetObj[q]["Count"]+=sData[p][q].Count;
		    						yNetObj[q]["Total"]+=sData[p][q].Total;
		    					}
	    					}
	    				}
	    			}
	    			tmp[-2]=yNetObj;  //异网
	    			tmp[-3]=bNetObj; //本网
	    			sData=tmp;
    			}
    			var result=new Object();
    			for(var p in sData){ //Dimen
    				var handObj=new Object();
      		   		if(sData[p][7]&&sData[p][7].Total&&sData[p][8]&&sData[p][8].Total)
      		   			handObj["OnlineSucPlay"]=sData[p][8].Total*100/sData[p][7].Total;
      		   		else
      		   			handObj["OnlineSucPlay"]=0;
	      		  	if(sData[p][4]&&sData[p][4].Total)
	  		   			handObj["Latency"]=(sData[p][4].Total/sData[p][4].Count)/1000;
	  		   		else
	  		   			handObj["Latency"]=0;
	      			if(sData[p][6]&&sData[p][6].Total&&sData[p][2]&&sData[p][2].Total)
      		   			handObj["timeProprot"]=(sData[p][2].Total*100/sData[p][6].Total)/1000000;
      		   		else
      		   			handObj["timeProprot"]=0;
	      			if(sData[p][6]&&sData[p][6].Total&&sData[p][14]&&sData[p][14].Total)
	      			    if(gtop.gsCompany==gtop.gpQingHai){
                            handObj["DownSpeed"]=(sData[p][14].Total*8/sData[p][6].Total)/(1024);
						}else{
                            handObj["DownSpeed"]=(sData[p][14].Total*8/sData[p][6].Total)/(1024*1024);
						}

      		   		else
      		   			handObj["DownSpeed"]=0;

	      			if(sData[p][6]&&sData[p][6].Total&&sData[p][3]&&sData[p][3].Total)
      		   			handObj["UnitTCaton"]=sData[p][3].Total*60/sData[p][6].Total;
      		   		else
      		   			handObj["UnitTCaton"]=0;
	      			if(sData[p][6]&&sData[p][6].Total&&sData[p][15]&&sData[p][15].Total)
      		   			handObj["CatonAcount"]=sData[p][15].Total*100/sData[p][7].Total;
      		   		else
      		   			handObj["CatonAcount"]=0;
	      			result[p]=handObj;
      		   	}

    			return result;
    		}

    		function handleData(sData){
    			//area,OnlineSucPlay,Latency,timeProprot,
    			var arr=new Array();
    			for(var i=0;i<sData.length;i++){
    				var objData=new Object();
    				if(sData[i].area==1){
    					if(gtop.DefProvinceID==1)
    						objData["area"]=gtop.gpArea.location;
    					else
    						continue;
    				}else if(sData[i].area==2){
						// 未知区域,暂不显示
    					continue;
    				}else{
						var pos=sData[i].area-2;
						if(gtop.gpArea.areaList[pos].id==sData[i].area){
							objData["area"]=gtop.gpArea.areaList[pos].location;
						}else{
							for(pos=0;pos<gtop.gpArea.areaList.length;pos++)
								if(gtop.gpArea.areaList[pos].id==sData[i].area){
									objData["area"]=gtop.gpArea.areaList[pos].location;
									break;
								}
						}
    				}
    				var arrsingle=new Array();
    				var tests=gtop.gpPlatform;
    				for(var j=0;j<sData[i].row.length;j++){
    					var objSingle=new Object();
    					if(mType==4){
// 	    					if(sData[i].row[j].key=="live"){
// 	    						objSingle["area"]="直播";
// 	    					}else if(sData[i].row[j].key=="vod"){
// 	    						continue;
// 	//     						objSingle["area"]="点播";
// 	    					}
    					}else if(mType==2){
    						if(sData[i].row[j].key=="-1")
    							objSingle["area"]="-1";
    						else{
    							if(!gtop.getPlatform(sData[i].row[j].key))
	    							continue;
	    						objSingle["area"]=gtop.gpPlatform[sData[i].row[j].key].name;
    						}
    					}else if(mType==3){
    						if(sData[i].row[j].key=="-1")
    							objSingle["area"]="-1";
    						else{
	    						for(var k=0;k<gtop.gpDevicePro.length;k++){
	    							if(sData[i].row[j].key==gtop.gpDevicePro[k].id){
	    								objSingle["area"]=gtop.gpDevicePro[k].name;
	    								break;
	    							}
	    						}
    						}
    					}else if(mType==mOperatorVal){
    						if(sData[i].row[j].key=="-1")
    							objSingle["area"]="-1";
    						else if(gtop.gsCompany!=gtop.gpSiHua){
   								objSingle["area"]=gtop.gpNetwork.Operators[sData[i].row[j].key];
    						}else{
    							objSingle["area"]=mOperatorCols[sData[i].row[j].key];
    						}
    					}
    					if(sData[i].row[j].SucProgCnt!=-1&&sData[i].row[j].TotProgCnt!=0){
    						objSingle["OnlineSucPlay"]=((sData[i].row[j].SucProgCnt/sData[i].row[j].TotProgCnt)*100).toFixed(2);
        				}else{
        					objSingle["OnlineSucPlay"]=0;
        				}
        				if(sData[i].row[j].Latency!=-1)
        					objSingle["Latency"]=(sData[i].row[j].Latency/1000).toFixed(0);
        				else
        					objSingle["Latency"]=0;
						//卡顿时间单位us 下载时间单位s
        				if(sData[i].row[j].TotDownSecs!=0){
        					var timeProprot=parseInt(sData[i].row[j].TotFreezeUs)/(parseInt(sData[i].row[j].TotDownSecs)*1000000)*100;
	        				objSingle["timeProprot"]=Math.abs(timeProprot.toFixed(2));
        				}
						if(objSingle.area!=noticeInfos[6]&&objSingle.area)
        					arrsingle.push(objSingle);
    				}
   					objData["row"]=arrsingle;
    				arr.push(objData);
    			}
    			return arr;
    		}
    		var mbIncludeShanXi=false;
    		var mLocationNum=0;
    		function setSelectLocation(){
    			mbIncludeShanXi=false;
    			//selected location
                var items = $("#areaMiguName").combobox('getValues');
                var str = "";
                for (var i = 0; i < items.length; i++) {
                    //如果
                    if(items[i]==8&&gtop.gsCompany==gtop.gpSiHua){
                        mbIncludeShanXi=true;
                        // continue;
                    }
                    str += items[i];
                    if(i<items.length-1) str += ",";
                }
                return str;
// 		      	mpParam.location=$("#id_area").val();

    		}

    		function setSelectPlatform(){
    			//selected location
                var items = $("#platMiguForm").combobox('getValues');
		      	var str = "";
		      	for (var i = 0; i < items.length; i++) {
		          str += items[i];
		          if(i<items.length-1) str += ",";
		      	}
		      	if(gtop.gsCompany==gtop.gpSiHua&&mpParam.dimension=="operator"){
		      		if(str.indexOf("2",0)!=-1&&str.indexOf("1",0)==-1)
		      			str="2";
		      		else if(str.indexOf("1",0)!=-1&&str.indexOf("2",0)==-1)
		      			str="1";
		      	}
		      	mpParam.platform=str;
    		}

    		function setTime(start,end){
    			var date = new Date();
                var hour=date.getHours();
        		var sec=date.getTime()/1000-86400;
        		var curDate,preDate;

    			date = new Date((sec - start * 86400) * 1000);
				curDate = date.format("yyyy-MM-dd");
				date = new Date((sec - end * 86400) * 1000);
				preDate = date.format("yyyy-MM-dd");
        		document.getElementById("id_dateFrom").value = preDate;
				document.getElementById("id_dateTo").value = curDate;

				if(mIndex==1){
                    for(var i=0;i<24;i++){
                        if(i<10){
                            $("#num1").append(new Option("0"+i,i));
                            $("#num2").append(new Option("0"+i,i));
                        }else{
                            $("#num1").append(new Option(i,i));
                            $("#num2").append(new Option(i,i));
                        }
                    }
                    document.getElementById("num1").value=00;
                    document.getElementById("num2").value=hour;
				}
    	    }

            function changeType(index) {
				if(index==1){
                    $("#num1").css("display","inline");
                    $("#num2").css("display","inline");
                    $(".la_hour").css("display","inline");
                    $("#id_label_dateTo")[0].style.left="465px";
                    $("#id_area")[0].style.left="500px";
                    $("#id_label_area")[0].style.left="605px";
                    $("#dimenType")[0].style.left="635px";
                    $("#id_platform")[0].style.left="740px";
                    $("#id_create")[0].style.left="870px";
                    $("#id_export")[0].style.left="960px";
				}else{
                    $("#num1").css("display","none");
                    $("#num2").css("display","none");
                    $(".la_hour").css("display","none");
                    $("#id_label_dateTo")[0].style.left="365px";
                    $("#id_area")[0].style.left="395px";
                    $("#id_label_area")[0].style.left="500px";
                    $("#dimenType")[0].style.left="535px";
                    $("#id_platform")[0].style.left="630px";
                    $("#id_create")[0].style.left="765px";
                    $("#id_export")[0].style.left="850px";
				}
            }

            var mIndex=2;
    		this.onChangeDate = function(event){
        		var index=event.currentTarget.selectedIndex;
        		if(index<0)
        			return;
        		var selKey=event.currentTarget.selectedOptions[0].value;

        		switch(selKey){
	        		case "curweek":{
	        		    if(mIndex==1){
                            mIndex=2;
                            changeType(mIndex);
						}
						setTime(0,6);
						break;
					}
					case "preweek":{
                        if(mIndex==1){
                            mIndex=2;
                            changeType(mIndex);
                        }
						setTime(7,13);
						break;
					}
					case "curmonth":{
                        if(mIndex==1){
                            mIndex=2;
                            changeType(mIndex);
                        }
						setTime(0,29);
						break;
					}
					case "premonth":{
                        if(mIndex==1){
                            mIndex=2;
                            changeType(mIndex);
                        }
						setTime(30,59);
						break;
					}
					case "curhour":{
                        mIndex=1;
                        changeType(mIndex);
                        setTime(-1,-1);
						break;
					}
        		}
    		}
    		//获取导出的数据
    		function getFileData(){
    			var strData="";
    			for(var i=0;i<mFinalData.length;i++){
    				var tmpdata=mFinalData[i];
    				for(var j=0;j<tmpdata.row.length;j++){
    					strData+=tmpdata.area+"#";
    					if(tmpdata.row[j].area!="-1")
    						strData+=tmpdata.row[j].area+"#";
                        if(typeof(tmpdata.row[j].Latency)!="undefined"){
                            strData+=tmpdata.row[j].Latency+"#";
                        }else{
                            strData+="#";
                        }
                        if(typeof(tmpdata.row[j].DownSpeed)!="undefined"){
                            strData+=tmpdata.row[j].DownSpeed+"#";
                        }else{
                            strData+="#";
                        }
                        if(typeof(tmpdata.row[j].EPGLoadSuc)!="undefined"){
                            strData+=tmpdata.row[j].EPGLoadSuc+"#";
                        }else{
                            strData+="#";
                        }



    					if(typeof(tmpdata.row[j].OnlineSucPlay)!="undefined"){
    						strData+=tmpdata.row[j].OnlineSucPlay+"#";
    					}else{
    						strData+="#";
    					}

    					if(typeof(tmpdata.row[j].timeProprot)!="undefined"){
    						strData+=tmpdata.row[j].timeProprot+"#";
    					}else{
    						strData+="#";
    					}

    					if(typeof(tmpdata.row[j].wifiAcount)!="undefined"){
    						strData+=tmpdata.row[j].wifiAcount+"#";
    					}else{
    						strData+="#";
    					}
    					if(typeof(tmpdata.row[j].UnitTCaton)!="undefined"){
    						strData+=tmpdata.row[j].UnitTCaton+"#";
    					}else{
    						strData+="#";
    					}
    					if(typeof(tmpdata.row[j].CatonAcount)!="undefined"){
    						strData+=tmpdata.row[j].CatonAcount+"#";
    					}else{
    						strData+="#";
    					}
    					if(typeof(tmpdata.row[j].EPGLoadDelay)!="undefined"){
    						strData+=tmpdata.row[j].EPGLoadDelay+"#";
    					}else{
    						strData+="#";
    					}

                        if(typeof(tmpdata.row[j].EPGRequests)!="undefined"){
                            strData+=tmpdata.row[j].EPGRequests+"#";
                        }else{
                            strData+="#";
                        }
                        if(typeof(tmpdata.row[j].EPGReponses)!="undefined"){
                            strData+=tmpdata.row[j].EPGReponses+"#";
                        }else{
                            strData+="#";
                        }

    					if(typeof(tmpdata.row[j].LoginSuc)!="undefined"){
    						strData+=tmpdata.row[j].LoginSuc+"@";
    					}else{
    						strData+="@";
    					}
    				}
    			}
    			return strData.substring(0,strData.length-1);
    		}
    		//导出报表
    		this.exportData=function(){
    		//	document.execCommand('SaveAs');  //命令的效果，只是这个命令只能在IE内核下运行。
    		/* 	var fileInput = document.getElementById("SaveFile");//隐藏的file文本框ID
    			fileInput.click(); */
    		//	var test=window.open("../output.csv");
    			var obj=new Object();
    			var type=reportSID.reportTitle.split(",");
    			obj["tabledata"]=getFileData();
    			obj["title"]=reportMiguSID.mpGridCol_text;
    			obj["tableType"]="MiGu";
    			//添加变量用以判断导出的Excel表前两列是否需要合并
    			obj["platform"]=bMerge;
    			var param=JSON.stringify(obj);
    			param=param.replace(/%/g,"%25");
    			$.ajax({complete:gComplete,
    				url:"reportaction!SaveMiguFile.action",
    				type:"post",
    				data:"paramData="+param,
    				datatype:"json",
    				success:(function(data){
    					mDownFilName=data.resultData;
    					downFile();
    				})
    			});
    		}
    		function downFile(){
    			var sTime = new Date().format("yyyyMMdd");
    			window.open("../temp/"+sTime+"/"+mDownFilName);
    		}
    		var mDimenIDs;
    		//根据当前省份，取出当前省份对一个的Dimensionality值
    		this.getDimenIDs=function(){
                var mpParam=new Object();
    		    var secFrom;
    		    var secTo;
                if(mIndex==1){
                    secFrom=document.getElementById("id_dateFrom").value+" "+$('#num1 option:selected').val()+":00:00";
                    secTo=document.getElementById("id_dateTo").value+" "+$('#num2 option:selected').val()+":00:00";
                    mpParam.secFrom=secFrom;
                    mpParam.secTo=secTo;
                }else{
                    secFrom=document.getElementById("id_dateFrom").value;
                    secTo=document.getElementById("id_dateTo").value;
                    mpParam.secFrom=secFrom+" 00:00:00";
                    mpParam.secTo=secTo+" 00:00:00";
                }
				if(secFrom==null||secTo==null){
					alert($.parseJSON(gtop.getSIDText("misc")).timeError2);
					return;
				}
				mpParam.locId=setSelectLocation();//$('#id_area option:selected').val();
				mpParam.type=mType;
                mpParam.tablename="qvodsum";
    			$.ajax({complete:gComplete,
    				url:"reportaction!returnDimenIDs.action",
    				type:"post",
    				data:"paramData="+JSON.stringify(mpParam),
    				datatype:"json",
    				success:(function(data){
   						mDimenIDs=data.resultData;
						setDimenVals();
    				})
    			});
    		}
    		function setDimenVals(){
    			if(mType==2){
    				setPlatform();
    			}else if(mType==3){
    				setDevPro();
    			}else if(mType==mOperatorVal){
    				setOperators();
    			}
    		}
    		//维度切换
    		var mType=2;
    		this.onChangeType = function(event){
    			var index=event.currentTarget.selectedIndex;
        		if(index<0)
        			return;
        		var selKey=event.currentTarget.selectedOptions[0].value;
        		mpParam.dimension=selKey;
        		switch(selKey){
        			case "platform":{
        				mType=2;
        				break;
        			}
//         			case "programtype":{
//         				mType=4;
//         				$("#id_platform").jqxComboBox({disabled: true});
//         				break;
//         			}
        			case "devProtype":
        				mType=3;
        				break;
        			case "operator":
        				mType=5;
        		}
        		this.getDimenIDs();
    		}
    	}

    </script>

	<style type="text/css">
		table.altrowstable {
			font-family: verdana,arial,sans-serif;
			font-size:11px;
			color:#333333;
			border-width: 1px;
			border-color: #CCCCCC;
			border-collapse: collapse;
		}
		table.altrowstable th {
			background:#b5cfd2 url('../resources/css/images/table_header.png');
			font-weight:normal;
			border-width: 1px;
			border-style: solid;
			border-color: #CCCCCC;
			border-left-color: #CCCCCC;
			height: 23px;
		}
		table.altrowstable td {
			border-width: 1px;
			border-style: solid;
			border-top-color:#ffffff;
			border-bottom-color:#ffffff;
			border-right-color:#CCCCCC;
			border-left-color: #CCCCCC;
			height: 23px;
		}
		table.altrowstable thead{
			font-weight:normal;
			background-color: #DDEBF4;
		}
		.oddrowcolor{
			background-color:#FFFFFF;
		}
		.evenrowcolor{
			background-color:#F7F7F7;
		}
		.advanced{
			background-color:#DDEBF4;
		}
        .checkBox{
            margin-left: 380px;
            margin-top: -23px;
        }
		.checkBox2{
			margin-left: 635px;
			margin-top: -23px;
		}

	</style>
</head>
<body onmousedown="whichButton(event)">
<div style="height:100%">
	<div class="css_search_bar" style="color: #242424;">
		<select id="id_datetype" onchange="mpReportMigu.onChangeDate(event);">
			<option id="id_curweek" value="curweek"></option>
			<option id="id_preweek" value="preweek"></option>
			<option id="id_curmonth" value="curmonth"></option>
			<option id="id_premonth" value="premonth"></option>
			<option id="id_curhour" value="curhour"></option>
		</select>
		<input id="id_dateFrom" type="date" value="2016-05-18" width="100" onchange="mpReportMigu.getDimenIDs()" />
		<select id="num1" style="display: none"></select>
		<label class="la_hour" style="display: none"></label>
		<label> ~ </label>
		<input id="id_dateTo" type="date" value="2016-05-19" width="100" onchange="mpReportMigu.getDimenIDs()" />
		<select id="num2" style="display: none"></select>
		<label class="la_hour" style="display: none"></label>
		<label id="id_label_dateTo" style="position: fixed; left: 350px;top: 4px;"></label>

		<!--<div id="id_area" style="width:100px;position: fixed; left: 385px;top: 0px;"></div>-->
<!-- 		<select id="id_area" style="margin-left:35px" onchange="mpReportMigu.getDimenIDs()"></select> -->

        <div class="checkBox">
            <input style="width:100px;position: fixed; left: 385pxpx;top: 0px;" class="easyui-combobox" name="areaMiguName"
                   id="areaMiguName"/>
        </div>


		<label id="id_label_area" style="position: fixed; left: 490px;top: 4px;"></label>
		<select id="dimenType" style="width:100px;position: fixed; left: 525px;top: 0px;"
			onchange="mpReportMigu.onChangeType(event);">
			<option id="id_platform_area" value="platform"></option>
<!-- 			<option id="id_programtype_area" value="programtype"></option> -->
			<option id="id_deviceprovider_area" value="devProtype"></option>
			<option id="id_operator" value="operator"></option>
		</select>
		<!--<div id="id_platform" style="width:120px;position: fixed; left: 635px;top: 0px;"></div>-->

		<div class="checkBox2">
			<input style="width:120px;position: fixed; left: 635pxpx;top: 0px;" class="easyui-combobox" name="platMiguForm"
				   id="platMiguForm"/>
		</div>

		<button id="id_create" class="buttonStyle" style="width:80px;position: fixed; left: 760px;top: 0px;"
			onclick="mpReportMigu.onGenerate()"></button>
		<button id="id_export" class="buttonStyle" onclick="mpReportMigu.exportData()" style="width:80px;position: fixed; left: 845px;top: 0px;">
			<img alt="export" src="../asset/ico/export.png" width="14" height="14"><label id="btn_export" ></label>
		</button>
	</div>
	<div id="id_body" style="overflow:auto;"></div>
</div>
</body>
</html>
